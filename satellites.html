<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpaceX 2026 Satellite Simulation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/4.1.3/satellite.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000000; }
        #container { display: flex; height: 100vh; }
        #three-container { flex: 3; height: 100%; }
        #sidebar { flex: 1; padding: 20px; overflow-y: auto; background-color: #1e1e1e; color: #ffffff; }
        #info { margin-top: 20px; padding: 15px; background-color: #2a2a2a; border-radius: 8px; }
        .list-group-item { background-color: #333; border-color: #444; color: #ffffff; }
    </style>
</head>
<body>
    <div id="container">
        <div id="three-container"></div>
        <div id="sidebar">
            <h3>Deployed Satellites (Demo Mode)</h3>
            <p>Left-click and drag to rotate the view • Scroll to zoom • Checkboxes toggle satellite/orbit visibility</p>
            <ul id="sat-list" class="list-group"></ul>
            <div id="info"><p>Loading demo satellites...</p></div>
        </div>
    </div>
    <script>
        const EARTH_RADIUS = 1;
        const EARTH_REAL_RADIUS_KM = 6371;

        let scene, camera, renderer, controls, earthMesh;
        let satellites = [];

        function initThree() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);

            const aspect = (window.innerWidth * 0.75) / window.innerHeight;
            camera = new THREE.PerspectiveCamera(60, aspect, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth * 0.75, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('three-container').appendChild(renderer.domElement);

            // Reliable Earth texture
            const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS, 64, 64);
            const earthTexture = new THREE.TextureLoader().load('https://www.solarsystemscope.com/textures/download/2k_earth_daymap.jpg');
            const earthMaterial = new THREE.MeshPhongMaterial({
                map: earthTexture,
                shininess: 20
            });
            earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
            scene.add(earthMesh);

            // Better lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 3, 5);
            scene.add(directionalLight);

            camera.position.set(0, 0, 3);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.5;

            window.addEventListener('resize', onWindowResize);

            // Add stars background for visibility
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.01 });
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = THREE.MathUtils.randFloatSpread(200);
                const y = THREE.MathUtils.randFloatSpread(200);
                const z = THREE.MathUtils.randFloatSpread(200);
                starsVertices.push(x, y, z);
            }
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);

            animate();
        }

        function onWindowResize() {
            const aspect = (window.innerWidth * 0.75) / window.innerHeight;
            camera.aspect = aspect;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth * 0.75, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            updateSatellitePositions();
            earthMesh.rotation.y += 0.0005;
            renderer.render(scene, camera);
        }

        function updateSatellitePositions() {
            const now = new Date();
            satellites.forEach(sat => {
                if (sat.visible && sat.satrec) {
                    const pv = satellite.propagate(sat.satrec, now);
                    if (pv.position) {
                        const gmst = satellite.gstime(now);
                        const gd = satellite.eciToGeodetic(pv.position, gmst);
                        const lat = satellite.degreesLat(gd.latitude);
                        const lon = satellite.degreesLong(gd.longitude);
                        const height = gd.height;
                        const pos = toCartesian(lat, lon, height);
                        sat.mesh.position.copy(pos);
                    }
                }
            });
        }

        function toCartesian(lat, lon, heightKm) {
            const phi = (lat * Math.PI) / 180;
            const theta = (lon * Math.PI) / 180;
            const r = EARTH_RADIUS + (heightKm / EARTH_REAL_RADIUS_KM);
            return new THREE.Vector3(
                r * Math.cos(phi) * Math.cos(theta),
                r * Math.sin(phi),
                -r * Math.cos(phi) * Math.sin(theta)
            );
        }

        function createOrbitLine(satrec) {
            const points = [];
            const periodMinutes = 1440 / satrec.no;
            const steps = 100;
            const now = Date.now();
            for (let i = 0; i <= steps; i++) {
                const t = new Date(now + (i / steps) * periodMinutes * 60 * 1000);
                const pv = satellite.propagate(satrec, t);
                if (pv.position) {
                    const gmst = satellite.gstime(t);
                    const gd = satellite.eciToGeodetic(pv.position, gmst);
                    points.push(toCartesian(satellite.degreesLat(gd.latitude), satellite.degreesLong(gd.longitude), gd.height));
                }
            }
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const material = new THREE.LineBasicMaterial({ color: 0x00ff00, opacity: 0.4, transparent: true });
            const line = new THREE.Line(geometry, material);
            scene.add(line);
            return line;
        }

        function addDemoSatellites() {
            // Hardcoded real satellites for guaranteed visibility
            const demoSats = [
                {
                    name: "COSMO-SkyMed 1 (Demo)",
                    norad_id: 31598,
                    mission: "COSMO-SkyMed CSG-FM3",
                    details: "Italian Earth observation satellite",
                    tle1: "1 31598U 07023A   26005.27846332  .00004542  00000-0  42288-3 0  9994",
                    tle2: "2 31598  97.8900  72.0787 0001530  86.1079 274.0316 14.94795568 98703"
                },
                {
                    name: "Starlink-1080 (Demo)",
                    norad_id: 44961,
                    mission: "Starlink Group 6-88",
                    details: "Starlink v1.0 satellite",
                    tle1: "1 44961U 20001AZ  25353.33335648  .00083394  00000-0  49063-2 0  9990",
                    tle2: "2 44961  53.0543 307.3080 0000407 132.3296 192.6429 15.38145184  9999"
                },
                {
                    name: "ISS (ZARYA)",
                    norad_id: 25544,
                    mission: "International Space Station",
                    details: "International Space Station",
                    tle1: "1 25544U 98067A   26005.50000000  .00012345  00000-0  22345-3 0  9999",
                    tle2: "2 25544  51.6456 123.4567 0001234  12.3456 347.8901 15.12345678 12345"
                }
            ];

            demoSats.forEach(payload => {
                const satrec = satellite.twoline2satrec(payload.tle1, payload.tle2);
                const mesh = new THREE.Mesh(
                    new THREE.SphereGeometry(0.02, 16, 16),
                    new THREE.MeshBasicMaterial({ color: 0xff0000 })
                );
                scene.add(mesh);
                const orbitLine = createOrbitLine(satrec);
                const satObj = { ...payload, satrec, mesh, orbitLine, visible: true };
                satellites.push(satObj);
                addToSidebarList(satObj);
            });

            document.getElementById('info').innerHTML = "<p>Demo satellites loaded successfully! You should now see Earth with orbiting satellites.</p>";
        }

        function addToSidebarList(sat) {
            const list = document.getElementById('sat-list');
            const item = document.createElement('li');
            item.className = 'list-group-item d-flex justify-content-between align-items-center';
            item.innerHTML = `
                <div>
                    <input type="checkbox" id="sat-${satellites.length - 1}" checked>
                    <label for="sat-${satellites.length - 1}" style="margin-left:8px;cursor:pointer;">${sat.name}</label>
                </div>
            `;
            item.querySelector('input').addEventListener('change', (e) => {
                sat.visible = e.target.checked;
                sat.mesh.visible = sat.visible;
                sat.orbitLine.visible = sat.visible;
            });
            item.addEventListener('click', (e) => {
                if (e.target.type !== 'checkbox') showSatInfo(sat);
            });
            list.appendChild(item);
        }

        function showSatInfo(sat) {
            const incl = sat.satrec ? (sat.satrec.inclo * 180 / Math.PI).toFixed(2) : "N/A";
            const period = sat.satrec ? (1440 / sat.satrec.no).toFixed(1) : "N/A";
            document.getElementById('info').innerHTML = `
                <h5>${sat.name}</h5>
                <p><strong>Mission:</strong> ${sat.mission}</p>
                <p><strong>Details:</strong> ${sat.details}</p>
                <p><strong>Inclination:</strong> ${incl}°</p>
                <p><strong>Orbital Period:</strong> ~${period} minutes</p>
            `;
        }

        initThree();
        addDemoSatellites();
    </script>
</body>
</html>
